05-RMON配置

本章节下载  (192.35 KB)

请您评分并反馈意见：5分

目  录

1 RMON

1.1 RMON简介

1.1.1 RMON工作机制

1.1.2 RMON组

1.1.3 采样类型

1.1.4 协议规范

1.2 配置RMON统计功能

1.2.1 功能简介

1.2.2 配置RMON以太网统计功能

1.2.3 配置RMON历史统计功能

1.3 配置RMON告警功能

1.4 RMON显示和维护

1.5 RMON典型配置举例

1.5.1 统计功能配置举例

1.5.2 历史统计功能配置举例

1.5.3 告警功能配置举例

 


1 RMON
1.1  RMON简介
RMON（Remote Network Monitoring，远程网络监视）是一种基于SNMP协议的网络管理协议，通常用来实现管理设备对被管理设备的远程监控和管理。

1.1.1  RMON工作机制
用户通过RMON功能可以周期性或者持续性统计以太网接口收发报文的个数，可以监控被管理设备上MIB节点的值，当这些值达到用户设置的阈值，设备会自动记录日志或者发送告警信息给管理设备，来实现管理设备对被管理设备的远程监控和管理。

SNMP是RMON实现的基础。RMON使用SNMP告警信息发送机制向管理设备发送告警信息告知告警变量的异常。虽然SNMP也定义了告警功能，但通常用于告知被管理设备上某功能是否运行正常、接口物理状态的变化等，两者监控的对象、触发条件以及报告的内容均不同。

RMON是SNMP功能的增强。RMON协议规定达到告警阈值时被管理设备能自动生成告警信息发送给设备的SNMP模块，所以管理设备不需要多次去获取MIB变量的值，进行比较，从而能够减少管理设备同被管理设备的通讯流量，达到简便而有力地管理大型互连网络的目的。

1.1.2  RMON组
RMON协议中定义了多个RMON组，设备实现了公有MIB中支持的统计组、历史组、事件组、告警组、代理配置组和用户历史组。此外，Comware系统还自定义和实现了扩展告警组，以增强告警组的功能。其中，代理配置组和用户历史组只支持MIB操作。

1. 统计组
统计组规定系统将持续地对端口的各种流量信息进行统计（目前只支持对以太网端口的统计），并将统计结果存储在以太网统计表（etherStatsTable）中以便管理设备随时查看。在指定接口下创建统计表项成功后，统计组就对当前接口的报文数进行统计，它统计的结果是一个连续的累加值。

统计信息包括网络冲突数、CRC校验错误报文数、过小（或超大）的数据报文数、广播、多播的报文数以及接收字节数、接收报文数等。

2. 历史组
历史组规定系统将按指定周期对端口的各种流量信息进行统计，并将统计结果存储在历史记录表（etherHistoryTable）中以便管理设备随时查看。历史组统计的是每个周期内端口接收报文的情况，统计数据包括带宽利用率、错误包数和总包数等，周期的长短可以通过命令行来配置。

3. 事件组
事件组用来定义事件索引号及事件的处理方式。事件组定义的事件用于告警组表项和扩展告警组表项中。当监控对象达到告警条件时，就会触发事件，事件有如下几种处理方式：

·     Log：将事件相关信息（事件发生的时间、事件的内容等）记录在本设备RMON MIB的事件日志表中，以便管理设备通过SNMP Get操作进行查看。

·     Trap：表示事件被触发时，会生成告警信息发送给设备的SNMP模块。

·     Log-Trap：表示事件被触发时，既在本设备上记录日志，又会生成告警信息发送给设备的SNMP模块。

·     None：不做任何处理。

4. 告警组
RMON告警管理可对指定的告警变量（如端口收到的报文总数etherStatsPkts）进行监视。用户定义了告警表项后，系统会按照定义的时间周期去获取被监视的告警变量的值，当告警变量的值大于或等于上限阈值时，触发一次上限告警事件；当告警变量的值小于或等于下限阈值，触发一次下限告警事件，告警管理将按照事件的定义进行相应的处理。

当告警变量的采样值在同一方向上连续多次超过阈值时，只会在第一次产生告警事件，后面的几次不会产生告警事件。即上限告警和下限告警是交替产生的，出现了一次上限告警，则下一次必为下限告警。如图1-1所示，告警变量的值（如图中黑色曲线所示）多次超过阈值（如图中蓝色直线所示），产生了多个交叉点，但只有红叉标识的交叉点才会触发告警事件，其它交叉点不会触发告警事件。

图1-1 上下限告警示意图



 

5. 扩展告警组
扩展告警表项可以对告警变量进行运算，然后将运算结果和配置的阈值比较，实现更为丰富的告警功能。

用户定义了扩展告警表项后，系统对扩展告警表项的处理如下：

(1)     对定义的扩展告警公式中的告警变量按照定义的时间间隔进行采样。

(2)     将采样值按照定义的运算公式进行计算。

(3)     将计算结果和设定的阈值进行比较，大于或等于上限阈值时，触发一次上限告警事件；小于或等于下限阈值，触发一次下限告警事件。

与告警组一样，当扩展告警组的运算结果在同一方向上连续多次超过阈值时，只会在第一次产生告警事件，后面的几次不会产生告警事件，即上限告警和下限告警是交替产生的。

1.1.3  采样类型
设备在监控告警组和扩展告警组的告警变量时，支持两种采样类型：

·     绝对值采样：设备按照采样间隔获取告警节点的值，直接用告警节点的值或者计算后获得的值和上限阈值、下限阈值进行比较，来触发对应的事件。

·     变化值采样：设备按照采样间隔对告警节点进行采样，并用当前采样时间点获取的值减去上一个采样时间点获取的值，得到告警节点在采样间隔内的变化值，直接用告警节点的变化值或者计算后得到的值和上限阈值、下限阈值进行比较，来触发对应的事件。

1.1.4  协议规范
与RMON相关的协议规范有：

·     RFC 4502：Remote Network Monitoring Management Information Base Version 2

·     RFC 2819：Remote Network Monitoring Management Information Base Status of this Memo

1.2  配置RMON统计功能
1.2.1  功能简介
RMON的统计功能可以通过RMON统计组或者RMON历史组来实现，但是两者统计的对象不同，请根据实际需要配置。

·     RMON统计组统计的是RMON以太网统计表里定义的变量，记录的是从RMON统计表项创建到当前阶段变量的累加值。

·     RMON历史组统计的是RMON历史记录表里定义的变量，记录的是每个周期内变量的累加值。

1.2.2  配置RMON以太网统计功能
1. 配置限制和指导
统计表项的entry-number必须全局唯一，如果已经在其他接口下使用，则创建操作失败。

每个接口下只能创建一个统计表项。

2. 配置步骤
(1)     进入系统视图。

system-view

(2)     进入以太网接口视图。

interface interface-type interface-number

(3)     创建统计表项。

rmon statistics entry-number [ owner text ]

1.2.3  配置RMON历史统计功能
1. 配置限制和指导
历史控制表项的entry-number必须全局唯一，如果已经在其他接口下使用，则创建操作失败。

同一接口下，可以创建多条历史控制表项，但要求不同表项entry-number和sampling-interval的值必须不同，否则创建操作失败。

在创建历史控制表项时，如果指定的buckets number参数值超出了设备实际支持的历史表容量时，该历史控制表项会被添加，但该表项对应生效的buckets number的值为设备实际支持的历史表容量。

2. 配置步骤
(1)     进入系统视图。

system-view

(2)     进入以太网接口视图。

interface interface-type interface-number

(3)     创建历史控制表项。

rmon history entry-number buckets number interval interval [ owner text ]

同一接口下可以创建多个历史控制表项。

1.3  配置RMON告警功能
1. 配置限制和指导
·     系统不允许创建两个配置完全相同的表项。如果新建表项参数的值和已存在表项对应参数的值完全相同，则创建操作失败。不同表项需要比较的参数不同，请参见表1-1。

·     系统对每种类型表项的总数均进行了限制，具体数目请参见表1-1。当某种类型表项的总数达到系统允许创建的最大数目时，创建操作失败。

表1-1 RMON配置约束表

表项名

需要比较的参数

最多可创建的表项数

事件表项

事件描述（description string）、事件类型（log、trap、logtrap或none）和团体名（security-string ）

60

告警表项

告警变量（alarm-variable）、采样间隔（sampling-interval）、采样类型（absolute或delta）、上限阈值（threshold-value1）和下限阈值（threshold-value2）

60

扩展告警表项

告警变量公式（prialarm-formula）、采样间隔（sampling-interval）、采样类型（absolute或delta）、上限阈值（threshold-value1）和下限阈值（threshold-value2）

50

 

2. 配置准备
如果触发告警事件时，需要向管理设备（NMS）发送告警信息，则在配置RMON告警功能之前，必须保证SNMP Agent已经正确配置。SNMP Agent的配置请参见“网络管理和监控配置指导”中的“SNMP”。

3. 配置步骤
(1)     进入系统视图。

system-view

(2)     （可选）创建事件表项。

rmon event entry-number [ description string ] { log | log-trap security-string | none | trap security-string } [ owner text ]

缺省情况下，事件表中不存在表项。

(3)     创建告警表项。

rmon alarm entry-number alarm-variable sampling-interval { absolute | delta } [ startup-alarm { falling | rising | rising-falling } ] rising-threshold threshold-value1 event-entry1 falling-threshold threshold-value2 event-entry2 [ owner text ]

配置时如果event-entry不存在也可以配置，但触发告警时不会有事件动作。

(4)     创建扩展告警表项。

rmon prialarm entry-number prialarm-formula prialarm-des sampling-interval { absolute | delta } [ startup-alarm { falling | rising | rising-falling } ] rising-threshold threshold-value1 event-entry1 falling-threshold threshold-value2 event-entry2 entrytype { forever | cycle cycle-period } [ owner text ]

配置时如果event-entry不存在也可以配置，但触发告警时不会有事件动作。

1.4  RMON显示和维护
在完成上述配置后，在任意视图下执行display命令可以显示配置后RMON的运行情况，通过查看显示信息，验证配置的效果。

表1-2 RMON显示和维护

操作

命令

显示RMON告警表项的相关信息

display rmon alarm [ entry-number ]

显示RMON事件表项的相关信息

display rmon event [ entry-number ]

显示事件日志表项的相关信息

display rmon eventlog [ entry-number ]

显示RMON历史控制表及历史采样信息

display rmon history [ interface-type interface-number ]

显示RMON扩展告警表项的相关信息

display rmon prialarm [ entry-number ]

显示RMON统计信息

display rmon statistics [ interface-type interface-number ]

 

1.5  RMON典型配置举例
1.5.1  统计功能配置举例
1. 组网需求
现需要通过RMON统计表对以太网接口GigabitEthernet2/0/1接收的报文进行性能统计。管理员随时查看统计数据了解接口接收报文的情况。

2. 组网图
图1-2 配置统计功能组网图



‌

3. 配置步骤
# 使用RMON对接口GigabitEthernet2/0/1进行流量统计。

<Sysname> system-view

[Sysname] interface gigabitethernet 2/0/1

[Sysname-GigabitEthernet2/0/1] rmon statistics 1 owner user1

4. 验证配置
完成以上配置后，系统就开始对接口GigabitEthernet2/0/1接收的报文进行分类统计，统计的结果可以通过多种方式查看：

·     查看接口的统计信息。

<Sysname> display rmon statistics gigabitethernet 2/0/1

EtherStatsEntry 1 owned by user1 is VALID.

  Interface : GigabitEthernet2/0/1<ifIndex.3>

  etherStatsOctets         : 21657     , etherStatsPkts          : 307

  etherStatsBroadcastPkts  : 56        , etherStatsMulticastPkts : 34

  etherStatsUndersizePkts  : 0         , etherStatsOversizePkts  : 0

  etherStatsFragments      : 0         , etherStatsJabbers       : 0

  etherStatsCRCAlignErrors : 0         , etherStatsCollisions    : 0

  etherStatsDropEvents (insufficient resources): 0

  Incoming packets by size:

  64     : 235       ,  65-127  : 67        ,  128-255  : 4

  256-511: 1         ,  512-1023: 0         ,  1024-1518: 0

·     在NMS上通过软件执行Get操作，直接获取MIB节点的值。

1.5.2  历史统计功能配置举例
1. 组网需求
现需要每1分钟通过RMON历史统计表对以太网接口GigabitEthernet2/0/1接收的报文进行周期性统计。管理员能够随时了解短时间内接口是否有数据突发。

2. 组网图
图1-3 配置历史统计功能组网图



‌

3. 配置步骤
# 使用RMON对接口GigabitEthernet2/0/1进行周期性流量统计。

<Sysname> system-view

[Sysname] interface gigabitethernet 2/0/1

[Sysname-GigabitEthernet2/0/1] rmon history 1 buckets 8 interval 60 owner user1

4. 验证配置
完成以上配置后，系统就开始对接口GigabitEthernet2/0/1接收的报文进行周期性分类统计，每1分钟统计一次，历史统计列表里会保存最近的8次统计的结果，以便管理员查看。统计的结果可以通过以下方式查看：

·     查看接口的历史统计信息。

[Sysname-GigabitEthernet2/0/1] display rmon history

HistoryControlEntry 1 owned by user1 is VALID

  Sampled interface     : GigabitEthernet2/0/1<ifIndex.3>

  Sampling interval     : 60(sec) with 8 buckets max

  Sampling record 1 :

    dropevents        : 0         , octets               : 834

    packets           : 8         , broadcast packets    : 1

    multicast packets : 6         , CRC alignment errors : 0

    undersize packets : 0         , oversize packets     : 0

    fragments         : 0         , jabbers              : 0

    collisions        : 0         , utilization          : 0

  Sampling record 2 :

    dropevents        : 0         , octets               : 962

    packets           : 10        , broadcast packets    : 3

    multicast packets : 6         , CRC alignment errors : 0

    undersize packets : 0         , oversize packets     : 0

    fragments         : 0         , jabbers              : 0

    collisions        : 0         , utilization          : 0

·     在NMS上通过软件执行Get操作，直接获取MIB节点的值。

1.5.3  告警功能配置举例
1. 组网需求
Device与Server和NMS相连。现需要对该服务器的流量进行统计，以5秒的采样间隔采样，当流量过大或过低时发送相应的告警信息给设备的SNMP模块，由SNMP模块通知NMS。

2. 组网图
图1-4 配置告警功能组网图



‌

3. 配置步骤
# 配置SNMP Agent。（请注意：这些参数的值应与NMS侧的配置一致，假设NMS上运行SNMP v1，访问设备时使用的可读团体名为public，可写团体名为private，NMS的IP地址为1.1.1.2）

<Sysname> system-view

[Sysname] snmp-agent

[Sysname] snmp-agent community read public

[Sysname] snmp-agent community write private

[Sysname] snmp-agent sys-info version v1

[Sysname] snmp-agent trap enable

[Sysname] snmp-agent trap log

[Sysname] snmp-agent target-host trap address udp-domain 1.1.1.2 params securityname public

# 使用RMON对以太网接口GigabitEthernet2/0/1进行统计。

[Sysname] interface gigabitethernet 2/0/1

[Sysname-GigabitEthernet2/0/1] rmon statistics 1 owner user1

[Sysname-GigabitEthernet2/0/1] quit

# 配置RMON告警表项。（当节点1.3.6.1.2.1.16.1.1.1.4.1的相对采样值超过100时或者低于50时，都触发事件1—生成告警信息发送给设备的SNMP模块）。

[Sysname] rmon event 1 trap public owner user1

[Sysname] rmon alarm 1 1.3.6.1.2.1.16.1.1.1.4.1 5 delta rising-threshold 100 1 falling-threshold 50 1 owner user1

4. 验证配置
# 查看RMON告警表信息。

<Sysname> display rmon alarm 1

AlarmEntry 1 owned by user1 is VALID.

  Sample type                    : delta

  Sampled variable               : 1.3.6.1.2.1.16.1.1.1.4.1<etherStatsOctets.1>

  Sampling interval (in seconds) : 5

  Rising threshold               : 100(associated with event 1)

  Falling threshold              : 50(associated with event 1)

  Alarm sent upon entry startup  : risingOrFallingAlarm

  Latest value                   : 0

# 查看以太网接口的统计信息。

<Sysname> display rmon statistics gigabitethernet 2/0/1

EtherStatsEntry 1 owned by user1 is VALID.

  Interface : GigabitEthernet2/0/1<ifIndex.3>

  etherStatsOctets         : 57329     , etherStatsPkts          : 455

  etherStatsBroadcastPkts  : 53        , etherStatsMulticastPkts : 353

  etherStatsUndersizePkts  : 0         , etherStatsOversizePkts  : 0

  etherStatsFragments      : 0         , etherStatsJabbers       : 0

  etherStatsCRCAlignErrors : 0         , etherStatsCollisions    : 0

  etherStatsDropEvents (insufficient resources): 0

  Incoming packets by size :

  64     : 7         ,  65-127  : 413       ,  128-255  : 35

  256-511: 0         ,  512-1023: 0         ,  1024-1518: 0

当告警事件被触发时，NMS将收到相应的告警信息。

 

不同款型规格的资料略有差异, 详细信息请向具体销售和400咨询。H3C保留在没有任何通知或提示的情况下对资料内容进行修改的权利!