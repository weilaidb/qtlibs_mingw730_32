《FPGA之道》
FPGA Field-Programmable Gate Array 
现场可编程门阵列
是一种主要以数字电路为主的集成芯片，为可编程器件的一种。

PLD:Programmable Logic Device 可编程逻辑器件
PLA:Programmable Logic Array  可编程逻辑阵列
PAL:Programmable Array Logic  可编程阵列逻辑
OLMC:Output Logic Macro Cell  可编程的输出逻辑宏单元
FPLA:Field Programmable Logic Array 现场可编程逻辑阵列
CPLD:Complex Programmable Logic Device 复杂可编程逻辑器件
LCA:Logic Cell Array  逻辑单元阵列

CPLD的优势:
1)CPLD更适合于触发器有限而乘积项丰富的结构
2)由于布线结构不同，CPLD时序延迟是均匀的和可预测的，而FPGA的时序延迟则具有不可预测性，所以CPLD的速度会比FPGA更快。
3)CPLD使用起来较方便，因为配置内容掉电不丢失，一般不需要外加配置芯片，所以CPLD保密性好，而FPGA的配置数据流容易被黑客截获，所以保密性差。

ASIC:Application Specific Integrated Circuit 专用集成电路
易称Soc:System on Chip  片上系统
SoPC:System on a Programmable Chip 可编程片上系统
是一种特殊的SoC,单个芯片完成整个系统的主要逻辑功能

TTL:Transistor-Transistor Logic 基于三级管结构的数字系统
输出端:
状态  电压 
1     >=2.4V
0     <=0.8V
输入端
状态   电压
1     >=2.0V
0     <=0.8V

LVTTL:Low Voltage Transistor-Transistor Logic 低压TTL电平标准
LVTTL3V3:内部有源器件的标准电压供给为3.3V 
LVTTL2V5:内部有源器件的标准电压供给为2.5V
输出端:
状态  电压 
1     >=2.0V
0     <=0.2V
输入端
状态   电压
1     >=1.7V
0     <=0.7V

CMOS:Complementary Metal Oxide Semiconductor 基于NMOS、PMOS组成的MOS管结构的数字系统之间的
输出端:
状态  电压 
1     >=4.45V
0     <=0.5V
输入端
状态   电压
1     >=3.5V
0     <=1.5V


LVCMOS
LVCMOS3V3
LVCMOS2V5
LVCMOS1V8
LVCMOS1V5
LVCMOS1V2

LVDS:Low Voltage Differential Signaling 低压差分信号，需要两根线完成通信。

RS232：Recommended Standard 推荐标准 ,232为标识号
RS232总线标准共设有25条信号线
状态  电压 
1     -15~3V
0     3~15V

RS485：RS232的升级版，采用差分形式传递信息
状态  电压 
1     2~6V
0     -6~-2V



BCD:Binary Coded Decimal 二一十进制码
常用的BCD编码
8421码
2421码
余三码
单位距离码
余三循环码

有权BCD码
[0111]8421BCD = 0 *8 + 1 * 4 + 1 * 2 + 1 * 1 = 7
[0111]2421BCD = 0 *2 + 1 * 4 + 1 * 2 + 1 * 1 = 7

无权BCD码
余三码是在8421码的基础上，对以每个码字加3得到的。

数字逻辑的基本运算
与、或、非  对应三个运算（逻辑乘、逻辑加、逻辑非） ---交集、并集、补集
与非
或非
与或非
异或
同或

真值表

SOP:sum of product 积之和表达式，与-或表达式
POS:product of sum 和之积表达式，或-非表达式

卡诺图
    
    
基本逻辑功能单元简介
缓冲门：
一个输入，一个输出，仅将输入端口的信号电平原封不动的搬移到输出端口
作用：提高输入信号的扇出能力

非门:
一个输入，一个输出，仅将输入端口的信号电平取反后，搬移到输出端口

三态门:
相当于一个可以控制通断的缓冲门
两个输入（数据输入、控制输入），一个输出
控制端口有效时，将数据输入端口的信号电平搬移到输出端口；
控制端口无效时，输出端为高阻状态，相当于和后续电路的连接断开。

与门：
两个以上的输入端口，一个输出
将所有端口的信号电平取逻辑与后，再搬移到输出端口

或门:
两个以上的输入端口，一个输出
将所有端口的信号电平取逻辑或后，再搬移到输出端口


与非门：
两个以上的输入端口，一个输出
将所有端口的信号电平取逻辑与非后，再搬移到输出端口


或非门:
两个以上的输入端口，一个输出
将所有端口的信号电平取逻辑或非后，再搬移到输出端口

异或门:
两个以上的输入端口，一个输出
将所有端口的信号电平取逻辑异或后，再搬移到输出端口


同或门:
两个以上的输入端口，一个输出
将所有端口的信号电平取逻辑同或后，再搬移到输出端口

小规模集成组合逻辑单元简介
多路利用器：多路选择器，MUX
一组控制输入端口、两个以上数据输入端口，一个输出端口
完成数据通道的复用，节省数据通道的个数。

编码器：
完成编码功能的单元
多个事件输入端口，一个有效输出端口和至少一个编码输出端口
功能是完成将多个输入信号轮换成一组二进制编码。

编码:用文字、符号或者数码来表示某种信息的过程

译码器：解码器，完成译码功能的单元
一个有效输入端口、至少一个编码输入端口、一个有效输出端口、一组事件输出端口


译码:将二进制编码还原为原始事件序列的过程


加法器
半加器
全加器
进位选择加法器
超前进位加法器

减法器
半减器
全减器


比较器

查找表:LUT Look Up Table
若干个输入端口，一个输出端口



时序逻辑基本单元简介
触发器:filp-flop FF
具有记忆一位二进制代码的记忆单元，输出具有两个稳定状态--状态0和状态1.
当外部有效的输入信号时，触发器的输出会发生状态翻转，即从一个稳定状态变化为另一个稳定状态；而当外部有效输入信号撤销后，触发器的输出能够保持在最新的状态，即在一次之前输出不会改变。
类型分:RS触发器、D触发器、JK触发器、T触发器
结构分：基本触发器、钟控触发器（包括同步触发器、主从触发器、边沿触发器）
触发方式分：电平触发器、边沿触发器 

锁存器与寄存器
锁存器：电平敏感型的触发器
寄存器：边沿敏感型的触发器


HDL:Hardware Description Language 硬件描述语言
VHDL:Very-High-Speed Intergrated Circuit Hardware Description Language 超高速集成电路硬件描述语言

Verilog HDL:简称Verilog
OVI:Open Verilog International 组织
VCS:Verilog Compiled Simulator 仿真器
SystemVerilog

软件设计是串行的
FPGA设计是并行的

HDL编译原理
1)将HDL语言转化为FPGA内部基本资源模块为基础的门级网表。
  把门级网表理解为一个用基本门电路搭建的数字电路图
2)将门级网表的各个资源映射到FPGA芯片内部的具体位置，并确定好连线开关等一些资源的配置状态，进而再生成用于配置FPGA的流文件


assign a1 = b1 & b2;
assign a2 <= c1 | c2;
assign a3 <= a1 ^ a2;


FPGA程序执行方式:并行、连续、无限。
并行：HDL代码都是并发执行的
连续:HDL执行是无时间间隔的，即无时无刻都在执行
无限:HDL代码周期是和系统运行时间一致的



逻辑资源块
CLB:Configurable Logic Block 
ALM:Adapive Logic Module

LUT:LUT Look Up Table  查找表

时钟网络资源
全局时钟网络资源
区域时钟网络资源
IO时钟网络资源

PLL:Phase Locked Loop 锁相环
LF:Low Frequencey 低通滤波器
VCO: 压控振荡器
PD: 鉴相器(鉴频器)

DCM:Digital Clock Manager 数字时钟管理员
DLL:delay-locked loop 延迟锁定环
BLOCK RAM: 硬件存储核

时序约束
时序分析

IOB：Input Output Block IO块
IOE: Input Output Element
PAD:FPGA芯片的金属管脚

SERDES:串并转换器
ISERDES：用于输入的
OSERDESL用于输出的

VCCIO:此管脚用于为用户IO资源供电的管脚
JTAG:Joint Test Action Group 联合测试行为组织
两大功能 电路的边界扫描测试和可编程芯片的在线系统编程

IP核:Intellectual property core 知识产权核








数字电路按逻辑功能不同，分:
组合逻辑电路：组合电路或组合逻辑
时序逻辑电路：时序电路或时序逻辑

组合逻辑电路:数字电路满足任意时刻的输出仅仅取决于该时刻的输入。
时序逻辑电路:数字电路任意时刻的输出不仅取决于当前的输入，还取决于数字电路原来的状态



开发流程
接到项目--前期调研与验证-->制定FPGA方案-->编写FPGA代码<-->功能仿真 -->时序分析-->上板调试-->结束 

项目方案的设计与制定
1)输出方案文档
 -- 写清楚项目背景
 -- 写清楚项目需求
 -- 写清楚方案框架
 -- 写清楚方案框架
    -方案框图
    -软、硬件工作划分
 -- 写清楚算法细节
 -- 确保逻辑完备性
 -- 确保实现无关性
 -- 确保书面易懂性

算法可行性仿真与验证
 --为什么 why?
 --何时做 when?
 --怎么做 How?
 

2)FPGA设计方案


FPGA代码开发
FPGA设计的功能与仿真
仿真的分类：前仿真和后仿真
前仿真：功能仿真，目的是从逻辑上分析HDL代码所描述电路的正确性
后仿真：时序仿真，它是将电路中门延迟的参数和各种电路单元之间的连线情况考虑在内后进行的仿真。
细致分：代码级仿真、门级仿真、映射后仿真、布局布线后仿真
代码级仿真、门级仿真：功能仿真
映射后仿真：仿真对象是门级网表经过转换后对应到FPGA上的具体逻辑资源聚类，此时可得到电路中的门延迟信息文件供仿真时使用
布局布线后仿真：时序仿真

FPGA设计的时序分析
时序分析STA：Static Timing Analysis,  静态时序分析，

时序仿真=功能仿真+逻辑等价性检查+时序分析

编译器：将HDL代码和约束文件转为FPGA芯片上的实际数字电路
五个方面:综合、翻译融合、映射、布局布线和配置文件生成。
综合的输入:HDL代码、综合设置、器件型号等。
综合设置：编译器综合FPGA设计时的指导信息，通常采用默认的综合设置来进行综合，有时需要人工去修改综合设置。
人工干预综合的方法：
1）修改编译策略：可选的编译策略包括:speed、aread、power optimization、minimum runtime、balance等
2）修改一般综合选项
keep hierarchy:保留层级选项
read core:读核选项
synthesis constraints file:综合约束文件选项
3）修改HDL综合选项
4）修改特殊综合选项

综合的输出
综合的输出：RTL门级网表和综合报告。
RTL:Register Transfer Level ，寄存器传输级网表
FPGA基本开发流程中FPGA顶层模块的门级仿真环节用到的那个门级网表，是FPGA设计对应的与、或、非等门电路单元的表达。

综合报告
综合报告包含了综合过程中输出的一些关键信息，最主要的是错误信息、警告信息和资源占用量信息。

编译流程之翻译融合
翻译融合：将输入的门级网表和约束信息转换为后续作业工具所能识别的逻辑连接。给出FPGA设计的顶层门级网表。
翻译融合的输入：RTL门级网表、翻译融合设置、器件型号等。
翻译融合的设置：
Macro Search Path:参考路径设置选项
Allow Unmatched LOC Constants:允许不匹配的引脚约束选项。

翻译融合的输出
翻译融合的输出：顶层可识别门级网表、翻译融合报告等

编译流程之映射
映射的输入：顶层可识别门级网表、映射设置、器件型号、位置约束、时序约束、管脚约束等
映射设置
Ignore User Timing Constrains:忽略用户时序约束选项。
Trim Unconnected Signals:删除无连接信号选项
Generate Detailed Map Report:产生详细映射报告选项
Pack I/O Registers/Latchs into IOB:使用接口资源中的寄存器选项。

映射的输出：顶层资源位置门级网表、门延时文件和映射报告。

编译流程之布局布线 ：将FPGA设计完全转换为FPGA芯片上具体数字电路实现。
布局布线的输入：顶层资源位置门级网表、布局布线设置、器件型号、管脚约束、时序约束等。

布局布线设置：
Place And Route Mode:布局布线模式选项。有三种：
Route Only (默认):表示认为映射环节所做的布局已经可以接受了，只进行布线工作 
Reentry Route：可重入布线模式，在自动布线开始后可以打断布线器的工作，进行若干手动布线操作，然后再对剩下的部分重新进行自动布线
Multi Pass Place And Route ：多次布局布线尝试模式，如果在当前的布局和设置下无法布出满足时序等指标的连线，则可以尝试重新调整布局后再次布线，其中尝试次数可由别的选项设置。
Place And Route Effort Level:布局布线努力程度。有Standard、Medium、High。
Ignore User Timing Constraints:忽略用户时序约束选项。
Use Bonded I/Os:使用闲置I/O资源选项。该选项指定是否可以使用闲置的I/O资源来完成某些布局或布线工作，默认不可以。
Generate Asynchronous Delay Report:产生异步延时报告选项。默认不产生
Generate Clock Region Report:产生时钟域报告选项。该选项表示是否在布局布线报告中添加时钟域的分析信息，默认不产生。
Generate Post-Place And Route Static Timing Report:产生布局布线后时序分析报告选项。默认产生。
Generate Post-Place And Route Simulation Model:产生布局布线后仿真模型选项。默认不产生
Number of Place And Route Iterations:布局布线器尝试次数选项。
Number of Results To Save:保存结果的次数选项。
Power Reduction:功耗优化选项。

布局布线的输出
布局布线的输出：最终资源位置门级网表、布线信息、延迟文件和布局布线报告。

编译流程之配置生成：转化为FPGA芯片的配置文件
配置生成的输入：最终资源位置门级网表、布线信息、配置生成设置、器件型号等。
配置生成的输出：配置文件和配置生成报告。

配置文件
JTAG接口 后缀名 *.sof
外部配置芯片 后缀名 *.pof
Flash配置 后缀名*.bit
PROM配置   *.mcs


程序设计
VHDL基本程序框架主要分为三部分:library、entity、architecture。
library <library_name>;
use <library_name>.<packege_name>.<function_name>;
use <library_name>.<packege_name>.all;
库分两类:设计库和资源库。
完整的标准资源库的引用描述如下:
library STD;
use STD.textio.all;
library IEEE;
use IEEE.std_logic_1164.all;
use IEEE.std_logic_textio.all;
use IEEE.std_logic_arith.all;
use IEEE.numeric_bit.all;
use IEEE.numeric_std.all;
use IEEE.std_logic_signed.all;
use IEEE.std_logic_unsigned.all;
use IEEE.math_real.all;
use IEEE.math_complex.all;

常用的就是IEEE标准库中的两三个程序包，通常VHDL代码的最开头都是这样的：
library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.STD_LOGIC_ARITH.ALL;
use IEEE.STD_LOGIC_UNSIGNED.ALL;





























