服务质量（QoS）
本文介绍了服务质量（QoS）的产生背景、度量指标、服务模型和基于DiffServ模型的QoS业务。
评分并提供意见反馈 :     
服务质量（QoS）
简介
了解QoS
相关信息
简介
本文介绍了服务质量（QoS）的产生背景、度量指标、服务模型和基于DiffServ模型的QoS业务。

QoS是数通的基本特性，交换机、路由器、防火墙、WLAN等产品均支持配置QoS。

了解QoS
产生背景
网络的普及和业务的多样化使得互联网流量激增，从而产生网络拥塞，增加转发时延，严重时还会产生丢包，导致业务质量下降甚至不可用。因此，要在网络上开展这些实时性业务，就必须解决网络拥塞问题。网络拥塞问题的最好解决办法是增加网络带宽，但从运营、维护的成本考虑，这是不现实的，最有效的解决方案就是应用一个“有保证”的策略对网络流量进行管理。

QoS（Quality of Service，服务质量）是有效管理网络资源的技术。QoS针对各种业务的不同需求，为其提供端到端的服务质量保证。在有限的带宽资源下，它允许不同的流量不平等地竞争网络资源，语音、视频和重要的数据应用在网络设备中可以优先得到服务。

度量指标
影响网络质量的因素包括传输链路的带宽、报文传送时延和抖动、以及丢包率等。因此，要提高网络的服务质量，就可以从保证传输链路的带宽，降低报文传送的时延和抖动，降低丢包率等方面着手。而这些影响网络服务质量的因素，也就成为QoS的度量指标。

带宽
带宽也称为吞吐量，是指在固定的时间内，从网络一端传输到另一端的最大数据位数，也可以理解为网络的两个节点之间特定数据流的平均速率。带宽的单位是比特/秒（bit/s）。

通常情况下，带宽越大，数据通行能力就越强，网络服务质量就越好。这就好比高速公路，车道越多，车辆通行能力就越强，发生堵车的概率就越低。对于网络用户而言，都希望带宽越大越好，但是相应的网络运营和维护成本也就越高。

时延
时延是指一个报文或分组从网络的发送端到接收端所需要的延迟时间，一般由传输延迟及处理延迟组成。

以语音传输为例，时延是指从说话者开始说话到对方听到所说内容的时间。一般人们察觉不到小于100毫秒的延迟。当延迟在100毫秒和300毫秒之间时，说话者可以察觉到对方回复的轻微停顿，这种停顿可能会使通话双方都感觉到不舒服。超过300毫秒，延迟就会很明显，用户开始互相等待对方的回复。当通话的一方不能及时接收到期望的回复时，说话者可能会重复所说的话，这样会与远端延迟的回复碰撞，导致重复。

抖动
网络拥塞会导致通过同一连接传输的分组延迟各不相同。抖动用来描述延迟变化的程度，也就是最大延迟与最小延迟的时间差。

抖动对于实时性的传输是一个重要参数。例如，语音和视像等实时业务极不容忍抖动，因为抖动会造成语音或视像的断续。

抖动也会影响一些网络协议的处理。有些协议是按固定的时间间隔发送交互性报文，抖动过大会导致协议震荡。

所有传输系统都有抖动，只要抖动在规定容差之内就不会影响服务质量。利用缓存可以克服过量的抖动，但这将增加时延。

丢包率
丢包率是指在网络传输过程中丢失报文的数量占传输报文总数的百分比。少量的丢包对业务的影响并不大，例如，在语音传输中，丢失一个比特或一个分组的信息，通话双方往往注意不到。在视频的传输中，丢失一个比特或一个分组可能造成在屏幕上瞬间的波形干扰，但能很快恢复正常。

使用TCP传送数据可以处理少量的丢包，因为TCP允许丢失的信息重发，但大量的丢包会影响传输效率。在QoS中，我们关注的是丢包的统计数据，也就是丢包率。所以正常传输时，将网络丢包率控制在一定范围内即可。

服务模型
如何在网络中通过部署来保证度量指标在一定的合理范围内，从而提高网络的服务质量呢？这就涉及到QoS服务模型。QoS服务模型是端到端QoS设计的方案。只有当网络中所有设备都遵循统一的QoS服务模型时，才能实现端到端的质量保证。主流的三大QoS服务模型为：

Best-Effort服务模型：尽力而为
Best-Effort是最简单的QoS服务模型，用户可以在任何时候，发出任意数量的报文，而且不需要通知网络。提供Best-Effort服务时，网络尽最大的可能来发送报文，但对时延、丢包率等性能不提供任何保证。Best-Effort服务模型适用于对时延、丢包率等性能要求不高的业务，是现在Internet的缺省服务模型，它适用于绝大多数网络应用，如FTP、E-Mail等。

IntServ服务模型：预留资源
IntServ模型是指用户在发送报文前，需要通过信令（Signaling）向网络描述自己的流量参数，申请特定的QoS服务。网络根据流量参数，预留资源以承诺满足该请求。在收到确认信息，确定网络已经为这个应用程序的报文预留了资源后，应用程序才开始发送报文。应用程序发送的报文应该控制在流量参数描述的范围内。网络节点需要为每个流维护一个状态，并基于这个状态执行相应的QoS动作，来满足对应用程序的承诺。

IntServ模型使用了RSVP（Resource Reservation Protocol）协议作为信令，在一条已知路径的网络拓扑上预留带宽、优先级等资源，路径沿途的各网元必须为每个要求服务质量保证的数据流预留想要的资源，通过RSVP信息的预留，各网元可以判断是否有足够的资源可以使用。只有所有的网元都给RSVP提供了足够的资源，“路径”方可建立。

DiffServ服务模型：差分服务
DiffServ模型的基本原理是将网络中的流量分成多个类，每个类享受不同的处理，尤其是网络出现拥塞时不同的类会享受不同级别的处理。同一类的业务在网络中会被聚合起来统一发送，保证相同的时延、抖动、丢包率等QoS指标。

与Intserv模型相比，DiffServ模型不需要信令。在DiffServ模型中，应用程序发出报文前，不需要预先向网络提出资源申请，而是通过设置报文的QoS参数信息，来告知网络节点它的QoS需求。网络不需要为每个流维护状态，而是根据每个报文流指定的QoS参数信息来提供差分服务，即对报文的服务等级划分，有差别地进行流量控制和转发，提供端到端的QoS保证。DiffServ模型充分考虑了IP网络本身灵活性、可扩展性强的特点，将复杂的服务质量保证通过报文自身携带的信息转换为单跳行为，从而大大减少了信令的工作，是当前网络中的主流服务模型。

基于DiffServ模型的QoS业务
交换机、路由器、防火墙、WLAN等产品均支持配置基于DiffServ服务模型的QoS业务。基于DiffServ模型的QoS业务主要分为以下几大类：

报文分类和标记

要实现差分服务，需要首先将数据包分为不同的类别或者设置为不同的优先级。报文分类即把数据包分为不同的类别，可以通过MQC配置中的流分类实现；报文标记即为数据包设置不同的优先级，可以通过优先级映射和重标记优先级实现。

流量监管、流量整形和接口限速

流量监管和流量整形可以将业务流量限制在特定的带宽内，当业务流量超过额定带宽时，超过的流量将被丢弃或缓存。其中，将超过的流量丢弃的技术称为流量监管，将超过的流量缓存的技术称为流量整形。接口限速分为基于接口的流量监管和基于接口的流量整形。

拥塞管理和拥塞避免

拥塞管理在网络发生拥塞时，将报文放入队列中缓存，并采取某种调度算法安排报文的转发次序。而拥塞避免可以监督网络资源的使用情况，当发现拥塞有加剧的趋势时采取主动丢弃报文的策略，通过调整流量来解除网络的过载。

其中，报文分类和标记是实现差分服务的前提和基础；流量监管、流量整形、接口限速、拥塞管理和拥塞避免从不同方面对网络流量及其分配的资源实施控制，是提供差分服务的具体体现。

相关信息
如果您想了解QoS的更多信息及配置方法，可参考以下产品文档：

S12700 V200R013C00 配置指南-QoS

CloudEngine 12800, 12800E V200R005C10 配置指南-QoS

AR100, AR120, AR160, AR1200, AR2200, AR3200, AR3600 V300R003 配置指南-QoS

无线接入控制器(AC和FITAP) V200R010C00 产品文档-QoS配置

USG6000, USG9500, NGFW Module V500R005C10 产品文档-配置指南-QoS