千兆网络PHY芯片 RTL8211E的实践应用

livslin16 2020-06-16 09:02:48   4335   收藏 40
文章标签： 芯片 以太网 pcb设计制作
版权
一、基础介绍
RTL8211E是Realtek瑞昱推出的一款高集成的网络接收PHY芯片，它符合10Base-T，100Base-TX和1000Base-T IEEE802.3标准，该芯片在网络通信中属于物理层，用于MAC与PHY之间的数据通信。目前有RTL8211E-VB-CG、RTL8211E-VL-CG、RTL8211EG-VB-CG等三个版本。RTL8211E的主要功能特性包括
1、满足1000Base-T IEEE802.3ab标准
2、满足100Base-TX IEEE802.3u标准
3、满足10Base-T IEEE802.3标准
4、支持IEEE 802.3 RGMII接口
5、支持IEEE 802.3 GMII、MII接口，仅RTL8211EG支持
6、支持网络唤醒功能
7、支持中断功能
8、支持交叉检测及自动校正
9、支持半工、全工操作
10、1000M通信用CAT 5网线可达到120m
11、RGMII接口可支持3.3V、2.5V、1.8V、1.5V信号
12、可提供三种网络状态的LED指示
————————————————



网络数据–>RJ45接口–>网络变压器–>网络PHY芯片–>MAC–>CPU，如图1。其中网络变压器到PHY之前传输接口一般为MDI，而PHY到MAC之前的传输接口一般包括有MII、RMII、SMII、SSMII、SSSMII、GMII、RGMII、SGMII、TBI、RTBI、XGMII、XAUI、XLAUI等，下面我们以RTL8211E为例对网络通信路径接口做一次梳理与总结：


RMII即Reduced MII，是MII的简化板，连线数量由MII的16根减少为8根。
TXD[1:0]：数据发送信号线，数据位宽为2，是MII接口的一半；
RXD[1:0]：数据接收信号线，数据位宽为2，是MII接口的一半；
TX_EN(Transmit Enable)：数据发送使能信号，与MII接口中的该信号线功能一样；
RX_ER(Receive Error)：数据接收错误提示信号，与MII接口中的该信号线功能一样；
CLK_REF：是由外部时钟源提供的50MHz参考时钟，与MII接口不同，MII接口中的接收时钟和发送时钟是分开的，而且都是由PHY芯片提供给MAC芯片的。这里需要注意的是，由于数据接收时钟是由外部晶振提供而不是由载波信号提取的，所以在PHY层芯片内的数据接收部分需要设计一个FIFO，用来协调两个不同的时钟,在发送接收的数据时提供缓冲。PHY层芯片的发送部分则不需要FIFO，它直接将接收到的数据发送到MAC就可以了。
CRS_DV：此信号是由MII接口中的RX_DV和CRS两个信号合并而成。当介质不空闲时，CRS_DV和RE_CLK相异步的方式给出。当CRS比RX_DV早结束时(即载波消失而队列中还有数据要传输时)，就会出现CRS_DV在半位元组的边界以25MHz/2.5MHz的频率在0、1之间的来回切换。因此，MAC能够从 CRS_DV中精确的恢复出RX_DV和CRS。
在100Mbps速率时，TX/RX每个时钟周期采样一个数据；在10Mbps速率时，TX/RX每隔10个周期采样一个数据，因而TX/RX数据需要在数据线上保留10个周期，相当于一个数据发送10次。
当PHY层芯片收到有效的载波信号后，CRS_DV信号变为有效，此时如果FIFO中还没有数据，则它会发送出全0的数据给MAC，然后当FIFO中填入有效的数据帧，数据帧的开头是“101010—”交叉的前导码，当数据中出现“01”的比特时，代表正式数据传输开始，MAC芯片检测到这一变化，从而开始接收数据。
当外部载波信号消失后，CRS_DV会变为无效，但如果FIFO中还有数据要发送时，CRS_DV在下一周期又会变为有效，然后再无效再有效，直到FIFO中数据发送完为止。在接收过程中如果出现无效的载波信号或者无效的数据编码，则RX_ER会变为有效，表示物理层芯片接收出错。
————————————————


二、RTL8211E之MDI接口设计
MDI（ Medium Dependent Interface ）介质相关接口与互联网连接一般通过信号传输端（TD+&TD-）和信号接收端（RD+ &RD-），然后再通过网络滤波器以及RJ-45与终端网络相连。

MDI连接属于高速信号连接，对MDI线路设计时时需特别注意，RTL8211E/RTL8211EG到10/100/1000M网络变压器，以及到RJ-45接口的路径需要尽可能短，RTL8211E/RTL8211EG到10/100/1000M网络变压器的距离不能超过12cm，而且两对接受或传输差分信号线需尽可能的接近，可使噪声影响互相抵消。一般两者之前距离等于一线宽，例如，信号线宽8mil，则D1的宽度为8mil。两组信号线之间的跟离D2一般推荐为30mil。
另外为了减小ESD的引影响，RJ-45与千兆网络H5007一个地平面，而RTL8211E/RTL8211EG 网络PHY芯片这两个地平面之前需要接一个2Kv的电容。同时考虑到EMI的影响，网络变压器的center tap引脚要求串一个电容与地相接。如下图：





三、RTL8211E之RGMII接口设计
MII是英文Medium Independent Interface的缩写，翻译成中文是“介质独立接口”，该接口一般应用于MAC层和PHY层之间的以太网数据传输，也可叫数据接口，MII即Reduced MII、是MII的简化。与MII接口相比，GMII的数据宽度由4位变为8位，GMII接口中的控制信号如TX_ER、TX_EN、RX_ER、RX_DV、CRS和COL的作用同MII接口中的一样，发送参考时钟GTX_CLK和接收参考时钟RX_CLK的频率均为125MHz(1000Mbps/8=125MHz)。
RGMII连接属于高速信号连接，对RGMII线路设计时时需特别注意，RTL8211E/RTL8211EG到MAC之间的不能超过2.5inch。
RGMII时钟信号与数据信号之间需要留20mils的间距，GMII 接收与发送布线长度之差还要超过100mils。
RGMII的布线都有一块没破坏的完整地平面。
为了EMI考虑，需要在PHY芯片RXC端放置一个RC滤波，并在MAC芯片TXC端放置一个RC滤波。

————————————————

三、PCB板设计
以太网信号属于频率较高的数字信号传输，以太网芯片的布线好坏直接影响网络信号质量，合理的PCB布线至关重要。PCB板层设计可根据FPGA资源利用的情况及BGA芯片的扇出情况进行设定，可使用常规的六层电路板设计布线，即SIG-GND-SIG-PWR-GND-SIG。信号层与接地层相邻，电源层与接地层配对，这样具有较好的信号完整性。建议对Rx±、Tx±差分对进行阻抗控制，阻抗控制在100欧姆±10%。
布线规则如下：

以太网接口速率较高，会产生较大的干扰，会在铜皮产生感应电流，在RJ45接口处需将除差分引脚外的信号全部挖空，挖空区避免走线。
机壳地走线加粗，一般为1mm，机壳地与板内板的边缘间距要大于或等于1mm。
3.电源地走线加粗。
等长要求，TX+与TX-信号做等长，RX+与RX-做等长，尽量保持差分对平行、等长、短距，避免过孔、交叉。由于管脚分布、过孔、以及走线空间等因素存在使得差分线长易不匹配，时序会发生偏移，还会引入共模干扰，降低信号质量。长度差通常控制在5mil以内。
TX与RX应分开不同层走线，如果同层，间距应拉开4W（4倍线宽）。
6.PHY芯片发热量较大，可适当考虑增加散热孔或背面开窗。



————————————————
版权声明：本文为CSDN博主「livslin16」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/livslin16/article/details/106780165
