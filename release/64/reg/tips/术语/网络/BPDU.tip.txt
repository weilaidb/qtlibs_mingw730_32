BPDU（BridgeProtocolDataUnit，网桥协议数据单元）


■　STP算法
IEEE802.1D标准定义了STP的生成树算法。该算法依赖于BID、路径开销和端口ID参数来做出决定。
•　BID（网桥ID）决定了桥接网络的中心，称为根网桥或根交换机。BID参数是一个8字节域，前2个字节（十进制数）称为“网桥优先级”，后6个字节（十六进制数）是交换机的一个MAC地址。网桥优先级小的BID优先，当网桥优先级相同时，BID中的后6个字节的MAC小的则BID优先。
•　路径开销决定到根网桥（根交换机）的路径。路径开销是用来衡量网桥之间的距离的远近的，路径开销与跳数无关，其值是两个网桥之间某条路径上所有链路开销的总和。最小的路径开销是到根交换机的最佳路径。带宽越大，STP开销越小。
•　端口ID
也决定到根交换机的路径。由2个字节组成，包括“端口优先级”和“端口号”，各占8位。端口ID大小的判定与BID相同。

STP通过发送BPDU（BridgeProtocolDataUnit，网桥协议数据单元）传递生成树协议，并执行判别过程，以生成无拓扑环的网络拓扑。BPDU是网桥之间用来交换生成树信息的特殊帧，包括根BID、根路径开销、发送者BID和端口ID信息。BPDU在网桥之间传播，包括交换机和所有配置来进行桥接的路由器。
判别过程如下：
（1）确定根交换机。
（2）计算到根交换机的最小路径开销。
（3）确定最小的发送者BID。
（4）确定最小的端口ID。

网桥为每个端口存储一个其收到的最佳BPDU，当有其他BPDU到达交换机的端口时，将依据上述顺序判断此BPDU是否比原来存储的BPDU更好。如果新收到的BPDU（或者本地生成的BPDU）更好，则替换原有值。

当一个网桥第一次被激活时，其上所有端口每隔一个HELLO时间（默认2s）发送一次BPDU；如果一个端口发现从其他网桥收到的BPDU比自己发送的好，则本地端口就停止发送BPDU；如果在最大老化时间（默认20s）内没有从邻居网桥收到更好的BPDU，则本地端口重新开始发送BPDU，即最大老化时间是最佳BPDU的超时时间。