================================opengrok-1.7.21
================================opengrok-1.7.21
================================opengrok-1.7.21
TOMCAT_PATH=/root/soft/web_notebook_online/apache-tomcat-9.0.54
TOMCAT_BIN_PATH=$TOMCAT_PATH/bin/
TOMCAT_WEBAPP_PATH=$TOMCAT_PATH/webapps
SOFT_PATH=/root/soft
WORK_PATH=/root/work
OPENGROK_TAR_PATH=/root/soft/opengrok-1.7.21.tar.gz
OPENGROK_PATH=/root/soft/opengrok-1.7.21
OPENGROK_JAR=$OPENGROK_PATH/lib/opengrok.jar
OPENGROK_WAR_NAME=source.war
OPENGROK_WAR=$OPENGROK_PATH/lib/$OPENGROK_WAR_NAME
OPENGROK_DATA=$WORK_PATH/opengrok/data/
OPENGROK_PROJECT=$WORK_PATH/git
OPENGROK_CONFIG=$WORK_PATH/opengrok/configuration.xml
#CTAGS_PATH=/usr/bin/ctags
CTAGS_PATH=/usr/local/bin/ctags 

#configuration.xml位置 
/root/work/opengrok/configuration.xml

#删除java 11
yum remove java-11-openjdk

#安装java 1.8
yum install java-1.8.0-openjdk

#查看java版本
java -version


###安装 
##sudo tar zxvf $OPENGROK_TAR_PATH -C /opt
##sudo mv /opt/opengrok-1.7.21 /opt/opengrok
##cd /opt/opengrok/tools
##sudo  python3 -m pip install opengrok-tools.tar.gz


##3.1 创建opengrok所需要的目录
##cd /opt/opengrok
##sudo mkdir -p /opt/opengrok/etc         # Opengrok配置文件目录
##sudo mkdir -p /index/src                # Opengrok索引代码目录（可以指定任意目录）
##sudo mkdir -p /opt/opengrok/database/data     # Opengrok索引数据目录
##
###拷贝代码 
##
###生成索引
##opengrok-indexer -J=-Djava.util.logging.config.file=/var/opengrok/logging.properties -a /opt/opengrok/lib/opengrok.jar --  -s /index/src -d /opt/opengrok/database/data -H -P -S -G -W /opt/opengrok/etc/configuration.xml -U http://localhost:8080/source

#执行命令
#先删除原始数据？
rm -rf $OPENGROK_DATA/*

#创建目录与拷贝war
mkdir -p $OPENGROK_DATA
cp $OPENGROK_WAR $TOMCAT_WEBAPP_PATH/$OPENGROK_WAR_NAME

opengrok-indexer -J=-Djava.util.logging.config.file=/var/opengrok/logging.properties -a $OPENGROK_JAR --  -s /index/src -d $OPENGROK_DATA -H -P -S -G -W $OPENGROK_CONFIG -U http://121.40.244.108:8080/source
opengrok-indexer -J=-Djava.util.logging.config.file=/var/opengrok/logging.properties -a $OPENGROK_JAR --  -s /index/src -d $OPENGROK_DATA -H -P -S -G -W $OPENGROK_CONFIG -U http://localhost:8080/source


java -Xmx2048m -jar $OPENGROK_JAR -W $OPENGROK_CONFIG -c $CTAGS_PATH -P -S -v -s $OPENGROK_PROJECT -d $OPENGROK_DATA

#java -jar $OPENGROK_JAR -W $OPENGROK_CONFIG -c $CTAGS_PATH -P -S -v -s $OPENGROK_PROJECT -d $OPENGROK_DATA
#java -Xmx524m -jar $OPENGROK_JAR -W $OPENGROK_CONFIG -c $CTAGS_PATH -P -S -v -s $OPENGROK_PROJECT -d $OPENGROK_DATA


#stop ,then start tomcat 
cd $TOMCAT_BIN_PATH && sh shutdown.sh 
cd $TOMCAT_BIN_PATH && sh startup.sh 

#configuration.xml为自动生成的文件，不必须自动创建。
#configuration.xml为自动生成的文件，不必须自动创建。
#configuration.xml为自动生成的文件，不必须自动创建。

