#!/bin/bash

set -e

dos2unix $0 > /dev/null 2>&1

PUBSCRIPT=$HOME/work/git/qtlibs_mingw730_32/release/64/reg/tips/BASH/scripts/public.sh.tip.txt

source $PUBSCRIPT

ROOTLINUX=$HOME/work/git/linux

buildLxImage()
{
ROOTPATH=$1
zImagePath=./out_vexpress_3_16/arch/arm/boot/zImage
dtbPath=./out_vexpress_3_16/arch/arm/boot/zImage

checkdirnoexistquit $ROOTPATH

echo "ROOTPATH:$1"

cd $ROOTPATH
make CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm O=./out_vexpress_3_16  vexpress_defconfig
make CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm O=./out_vexpress_3_16 menuconfig
##zImage
make CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm O=./out_vexpress_3_16 zImage -j8
##modules
make CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm  O=./out_vexpress_3_16 modules
#modules install path
make CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm  O=./out_vexpress_3_16 modules_install INSTALL_MOD_PATH=../app

#make dtbs
make dtbs  CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm  O=./out_vexpress_3_16
lsinfo $zImagePath

}

echo "==========================begin"
echo $PUBSCRIPT
lsinfo $PUBSCRIPT


buildLxImage $ROOTLINUX
