#!/bin/sh

set -e

dos2unix $0 > /dev/null 2>&1

PUBSCRIPT=$HOME/work/git/qtlibs_mingw730_32/release/64/reg/tips/BASH/scripts/public.sh.tip.txt

source $PUBSCRIPT

ROOT_BUSYBOX=$HOME/work/git/busybox2


compile_busybox()
{
BUSYBOXPATH=$1
checkdirnoexistquit $BUSYBOXPATH
cd $BUSYBOXPATH
make defconfig
#make menuconfig
make CROSS_COMPILE=arm-linux-gnueabi- -j8
make install


}

make_rootfs()
{
BUSYBOXPATH=$1
checkdirnoexistquit $BUSYBOXPATH
cd $BUSYBOXPATH

sudo rm -rf rootfs
sudo rm -rf tmpfs
sudo rm -f a9rootfs.ext3
sudo mkdir rootfs
sudo cp _install/*  rootfs/ -raf
mkdir -p rootfs/{lib,proc,sys,tmp,root,var,mnt}
sudo cp -arf /usr/local/gcc-arm-none-eabi/arm-none-linux-gnueabi/lib rootfs/
sudo cp etc rootfs/ -arf
sudo rm rootfs/lib/*.a
sudo mkdir -p rootfs/dev/
sudo mknod rootfs/dev/tty1 c 4 1
sudo mknod rootfs/dev/tty2 c 4 2pro
sudo mknod rootfs/dev/tty3 c 4 3
sudo mknod rootfs/dev/tty4 c 4 4
sudo mknod rootfs/dev/console c 5 1
sudo mknod rootfs/dev/null c 1 3
sudo dd if=/dev/zero of=a9rootfs.ext3 bs=1M count=32
sudo mkfs.ext3 a9rootfs.ext3
sudo mkdir -p tmpfs
sudo mount -t ext3 a9rootfs.ext3 tmpfs/ -o loop
sudo cp -r rootfs/*  tmpfs/
sudo umount tmpfs

}






#########main proc
#compile_busybox $ROOT_BUSYBOX
make_rootfs $ROOT_BUSYBOX


